## 스프링 시큐리티와 OAuth 2.0으로 로그인 구현하기

스프링 시큐리티는 막강한 인증과 권한부여 기능을 가진 프레임워크이다. 사실상 스프링 기반의 애플리케이션에서는 보안을 위한 표준이라고 보면 되고 인터셉터, 필터 기반의 보안 기능을 구현하는 것보다는 스프링 시큐리티를 통해 구현하는 것을 권장하고 있다.



### 스프링 시큐리티와 스프링 시큐리티 Oauth2 클라이언트

많은 서비스를 보면 소셜 로그인으로 로그인 서비스를 대신하는 것을 볼 수 있다. 그렇다면 왜 로그인 기능이 아닌 소셜 로그인 기능을 사용하는 것일까? 소셜 로그인을 사용하면 많은 구현 부분을 생략할 수 있다.

> 로그인 기능 구축 시 필요한 구현
>
> - 로그인 시 보안
> - 회원가입 시 이메일 혹은 전화번호 인증
> - 비밀번호 찾기
> - 비밀번호 변경
> - 회원정보 변경

소셜 로그인을 사용하면 위 같은 구현 부분을 소셜(구글, 네이버, 카카오, 페이스북)에게 맡기면 된다.

**스프링 부트 1.5 vs 스프링 부트 2.0**

스프링 부트 1.5에서의  OAuth2 연동 방법이 2.0에서는 크게 변경되었는데, **spring-security-oauth2-autoconfigure** 라이브러리를 사용하면 클라이언트 입장에서는 크게 변경할 부분이 없다.

만약 스프링 1.5에서 2.0으로 변경하고자 하는데, spring-security-oauth2-autoconfigure 라이브러를 사용하고 있으면 설정변경 없이 그대로 사용할 수 있다.

스프링 부트 1.5와 2.x의 차이를 보면,

~~~properties
# 1.5
google : 
	client : 
		celientId : 인증정보
		clientSecret : 인증정보
		accessTokenUri : https://accounts.goolge.com/o/oauth2/token
		userAuthorizationUri : https://accounts.google.com/o/oauth2/auth
		...

# 2.x
spring :
	security :
		oauth2 :
			client :
				clientId : 인증정보
				clientSecret : 인증정보
~~~

스프링 부트 1.5 방식은 url 주소를 모두 명시해야 하지만, 2.x 방식에서는 client 인증정보만 입력하면 된다. 1.5버전에서 입력했던 값들은 2.x로 오면서 모두 enum으로 대체되었다.

**CommonOAuth2Provider라는 enum이 새로 추가되어 구글, 깃허브, 페이스북, 옥타의 기본 설정값은 모두 여기서 제공된다.**



### 구글 서비스 등록

먼저 구글 서비스에 신규 서비스를 생성하자.

구글 클라우드 플랫폼 주소 : https://console.cloud.google.com

My Project > 새 프로젝트로 프로젝트를 만들자.

<img src="https://user-images.githubusercontent.com/40616436/102355653-8372bb00-3fef-11eb-99d0-b51c5f9a659f.png" alt="image" style="zoom:50%;" />

<img src="https://user-images.githubusercontent.com/40616436/102355865-caf94700-3fef-11eb-8dc7-6cbfeb124d87.png" alt="image" style="zoom:50%;" />

다음으로는 사용자 인증 정보를 만들어보자.

<img src="https://user-images.githubusercontent.com/40616436/102356032-0b58c500-3ff0-11eb-94c4-63aafe1fb49c.png" alt="image" style="zoom:50%;" />

<img src="https://user-images.githubusercontent.com/40616436/102356264-570b6e80-3ff0-11eb-953c-27b3dc5cb65e.png" alt="image" style="zoom:50%;" />

<img src="https://user-images.githubusercontent.com/40616436/102356462-946ffc00-3ff0-11eb-8d5b-9ba75fa79071.png" alt="image" style="zoom:50%;" />

다음으로는 동의화면을 구성해보자.

<img src="https://user-images.githubusercontent.com/40616436/102481184-b88d1500-40a4-11eb-949c-6af8874b783c.png" alt="image" style="zoom:50%;" /> 

동의화면을 구성한 후 OAuth 클라이언트 ID 만들기를 접속한다.

<img src="https://user-images.githubusercontent.com/40616436/102481399-03a72800-40a5-11eb-963d-a7449fd68bef.png" alt="image" style="zoom:50%;" />

<img src="https://user-images.githubusercontent.com/40616436/102481680-613b7480-40a5-11eb-8f0c-b94a87723c05.png" alt="image" style="zoom:50%;" />

애플리케이션 유형 및 이름, URI 설정 후 만들기를 클릭한다.

<img src="https://user-images.githubusercontent.com/40616436/102481905-c2fbde80-40a5-11eb-9d9f-91f273dc4fd0.png" alt="image" style="zoom:50%;" />

**application-oauth 등록**

Src/main/resources/ 디렉토리에 application-oauth.properties 파일을 생성한다.

<img src="https://user-images.githubusercontent.com/40616436/102482171-26860c00-40a6-11eb-8605-77d44f4fda1b.png" alt="image" style="zoom:50%;" />

그리고 해당 파일에 클라이언트 ID와 클라이언트 보안 비밀 코드를 다음과 같이 등록한다.

~~~properties
spring.security.oauth2.client.registration.google.colient-id=클라이언트 ID
spring.security.oauth2.client.registration.google.colient-secret=클라이언트 보안 비밀
spring.security.oauth2.client.registration.google.scope=profile,email
~~~





